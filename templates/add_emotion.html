{% extends "base.html" %}

{% block title %}æ·»åŠ æƒ…ç»ª - æƒ…ç»ªåœ°å›¾{% endblock %}

{% block head %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<style>
    /* ç¡®ä¿é¡µé¢å¯ä»¥æ­£å¸¸æ»šåŠ¨ */
    html, body {
        overflow-x: hidden;
        overflow-y: auto;
        background-color: white !important;
    }
    
    /* ç§»åŠ¨ç«¯æ»šåŠ¨ä¼˜åŒ– */
    * {
        -webkit-overflow-scrolling: touch;
    }
    .add-emotion-container {
        max-width: 800px;
        margin: 2rem auto;
        padding: 2rem;
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        min-height: calc(100vh - 160px);
    }
    
    .form-group {
        margin-bottom: 1.5rem;
    }
    
    .form-label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: #374151;
    }
    
    .form-input {
        width: 100%;
        padding: 0.75rem;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        font-size: 1rem;
        transition: border-color 0.2s;
    }
    
    .form-input:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    
    .emotion-types {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 1rem;
        margin-top: 0.5rem;
    }
    
    .emotion-type {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 1rem;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s;
        background: white;
    }
    
    .emotion-type:hover {
        border-color: #3b82f6;
        background: #f8fafc;
    }
    
    .emotion-type.selected {
        border-color: #3b82f6;
        background: #eff6ff;
    }
    
    .emotion-icon {
        font-size: 2rem;
        margin-bottom: 0.5rem;
    }
    
    .emotion-name {
        font-size: 0.875rem;
        font-weight: 500;
        text-align: center;
    }
    
    .intensity-slider {
        width: 100%;
        height: 8px;
        border-radius: 4px;
        background: #e5e7eb;
        outline: none;
        -webkit-appearance: none;
    }
    
    .intensity-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #3b82f6;
        cursor: pointer;
    }
    
    .intensity-labels {
        display: flex;
        justify-content: space-between;
        margin-top: 0.5rem;
        font-size: 0.875rem;
        color: #6b7280;
    }
    
    #intensityValue {
        background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        color: white;
        padding: 0.75rem 1.5rem;
        border-radius: 25px;
        font-weight: 800;
        font-size: 1.1rem;
        border: 3px solid #1e40af;
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.5), 0 0 0 2px rgba(59, 130, 246, 0.2);
        transition: all 0.3s ease;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        position: relative;
        overflow: hidden;
    }
    
    #intensityValue::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
        transition: left 0.5s;
    }
    
    #intensityValue:hover::before {
        left: 100%;
    }
    
    .map-container {
        height: 300px;
        border-radius: 8px;
        overflow: hidden;
        border: 2px solid #e5e7eb;
    }
    
    .location-info {
        margin-top: 0.5rem;
        padding: 0.75rem;
        background: #f3f4f6;
        border-radius: 6px;
        font-size: 0.875rem;
        color: #374151;
    }
    
    .btn-group {
        display: flex;
        gap: 1rem;
        margin-top: 2rem;
    }
    
    .btn {
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        text-decoration: none;
        display: inline-block;
        text-align: center;
    }
    
    .btn-primary {
        background: #3b82f6;
        color: white;
    }
    
    .btn-primary:hover {
        background: #2563eb;
    }
    
    .btn-secondary {
        background: #6b7280;
        color: white;
    }
    
    /* éšç§è®¾ç½®æ ·å¼ */
    .privacy-options {
        display: flex;
        gap: 1rem;
        margin-top: 0.5rem;
    }
    
    .privacy-option {
        flex: 1;
    }
    
    .privacy-option input[type="radio"] {
        display: none;
    }
    
    .privacy-label {
        display: flex;
        align-items: center;
        padding: 1rem;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s;
        background: white;
        gap: 0.75rem;
    }
    
    .privacy-label:hover {
        border-color: #3b82f6;
        background: #f8fafc;
    }
    
    .privacy-option input[type="radio"]:checked + .privacy-label {
        border-color: #3b82f6;
        background: #eff6ff;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    
    .privacy-icon {
        font-size: 1.5rem;
        flex-shrink: 0;
    }
    
    .privacy-text {
        flex: 1;
    }
    
    .privacy-title {
        font-weight: 600;
        color: #374151;
        margin-bottom: 0.25rem;
    }
    
    .privacy-desc {
        font-size: 0.875rem;
        color: #6b7280;
    }
    
    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 640px) {
        .privacy-options {
            flex-direction: column;
        }
    }
    
    .btn-secondary:hover {
        background: #4b5563;
    }
    
    .error-message {
        color: #dc2626;
        font-size: 0.875rem;
        margin-top: 0.25rem;
    }
    
    .success-message {
        color: #059669;
        font-size: 0.875rem;
        margin-top: 0.25rem;
    }
    
    .custom-emotion-selector {
        background: #f8fafc;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        padding: 1.5rem;
        margin-top: 1rem;
    }
    
    .custom-emotions-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
        gap: 0.75rem;
        margin-top: 1rem;
        max-height: 300px;
        overflow-y: auto;
        padding: 0.5rem;
    }
    
    .custom-emotion {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 50px;
        height: 50px;
        font-size: 1.5rem;
        border: 2px solid #e5e7eb;
        border-radius: 50%;
        cursor: pointer;
        transition: all 0.2s ease;
        background: white;
        user-select: none;
    }
    
    .custom-emotion:hover {
        border-color: #3b82f6;
        background: #eff6ff;
        transform: scale(1.1);
        box-shadow: 0 2px 8px rgba(59, 130, 246, 0.2);
    }
    
    .custom-emotion.selected {
        border-color: #3b82f6;
        background: #3b82f6;
        color: white;
        transform: scale(1.1);
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
    }
</style>
{% endblock %}

{% block content %}
<div class="add-emotion-container">
    <h1 class="text-3xl font-bold text-gray-800 mb-6">æ·»åŠ æ–°æƒ…ç»ª</h1>
    
    <form id="addEmotionForm">
        <!-- æƒ…ç»ªç±»å‹é€‰æ‹© -->
        <div class="form-group">
            <label class="form-label">é€‰æ‹©æƒ…ç»ªç±»å‹ *</label>
            <div class="emotion-types">
                <div class="emotion-type" data-type="happy">
                    <div class="emotion-icon">ğŸ˜Š</div>
                    <div class="emotion-name">å¼€å¿ƒ</div>
                </div>
                <div class="emotion-type" data-type="sad">
                    <div class="emotion-icon">ğŸ˜¢</div>
                    <div class="emotion-name">éš¾è¿‡</div>
                </div>
                <div class="emotion-type" data-type="angry">
                    <div class="emotion-icon">ğŸ˜ </div>
                    <div class="emotion-name">æ„¤æ€’</div>
                </div>
                <div class="emotion-type" data-type="anxious">
                    <div class="emotion-icon">ğŸ˜°</div>
                    <div class="emotion-name">ç„¦è™‘</div>
                </div>
                <div class="emotion-type" data-type="excited">
                    <div class="emotion-icon">ğŸ¤©</div>
                    <div class="emotion-name">å…´å¥‹</div>
                </div>
                <div class="emotion-type" data-type="calm">
                    <div class="emotion-icon">ğŸ˜Œ</div>
                    <div class="emotion-name">å¹³é™</div>
                </div>
                <div class="emotion-type" data-type="confused">
                    <div class="emotion-icon">ğŸ˜•</div>
                    <div class="emotion-name">å›°æƒ‘</div>
                </div>
                <div class="emotion-type" data-type="grateful">
                    <div class="emotion-icon">ğŸ™</div>
                    <div class="emotion-name">æ„Ÿæ¿€</div>
                </div>
                <div class="emotion-type" data-type="custom">
                    <div class="emotion-icon">ğŸ­</div>
                    <div class="emotion-name">è‡ªå®šä¹‰</div>
                </div>
            </div>
            
            <!-- è‡ªå®šä¹‰å¿ƒæƒ…é€‰æ‹©å™¨ -->
            <div id="customEmotionSelector" class="custom-emotion-selector" style="display: none; margin-top: 1rem;">
                <label class="form-label">é€‰æ‹©ä½ çš„å¿ƒæƒ…è¡¨æƒ…</label>
                <div class="custom-emotions-grid">
                    <div class="custom-emotion" data-emoji="ğŸ˜€">ğŸ˜€</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜ƒ">ğŸ˜ƒ</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜„">ğŸ˜„</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜">ğŸ˜</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜†">ğŸ˜†</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜…">ğŸ˜…</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜‚">ğŸ˜‚</div>
                    <div class="custom-emotion" data-emoji="ğŸ¤£">ğŸ¤£</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜Š">ğŸ˜Š</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜‡">ğŸ˜‡</div>
                    <div class="custom-emotion" data-emoji="ğŸ™‚">ğŸ™‚</div>
                    <div class="custom-emotion" data-emoji="ğŸ™ƒ">ğŸ™ƒ</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜‰">ğŸ˜‰</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜Œ">ğŸ˜Œ</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜">ğŸ˜</div>
                    <div class="custom-emotion" data-emoji="ğŸ¥°">ğŸ¥°</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜˜">ğŸ˜˜</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜—">ğŸ˜—</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜™">ğŸ˜™</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜š">ğŸ˜š</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜‹">ğŸ˜‹</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜›">ğŸ˜›</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜">ğŸ˜</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜œ">ğŸ˜œ</div>
                    <div class="custom-emotion" data-emoji="ğŸ¤ª">ğŸ¤ª</div>
                    <div class="custom-emotion" data-emoji="ğŸ¤¨">ğŸ¤¨</div>
                    <div class="custom-emotion" data-emoji="ğŸ§">ğŸ§</div>
                    <div class="custom-emotion" data-emoji="ğŸ¤“">ğŸ¤“</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜">ğŸ˜</div>
                    <div class="custom-emotion" data-emoji="ğŸ¤©">ğŸ¤©</div>
                    <div class="custom-emotion" data-emoji="ğŸ¥³">ğŸ¥³</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜">ğŸ˜</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜’">ğŸ˜’</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜">ğŸ˜</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜”">ğŸ˜”</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜Ÿ">ğŸ˜Ÿ</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜•">ğŸ˜•</div>
                    <div class="custom-emotion" data-emoji="ğŸ™">ğŸ™</div>
                    <div class="custom-emotion" data-emoji="â˜¹ï¸">â˜¹ï¸</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜£">ğŸ˜£</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜–">ğŸ˜–</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜«">ğŸ˜«</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜©">ğŸ˜©</div>
                    <div class="custom-emotion" data-emoji="ğŸ¥º">ğŸ¥º</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜¢">ğŸ˜¢</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜­">ğŸ˜­</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜¤">ğŸ˜¤</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜ ">ğŸ˜ </div>
                    <div class="custom-emotion" data-emoji="ğŸ˜¡">ğŸ˜¡</div>
                    <div class="custom-emotion" data-emoji="ğŸ¤¬">ğŸ¤¬</div>
                    <div class="custom-emotion" data-emoji="ğŸ¤¯">ğŸ¤¯</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜³">ğŸ˜³</div>
                    <div class="custom-emotion" data-emoji="ğŸ¥µ">ğŸ¥µ</div>
                    <div class="custom-emotion" data-emoji="ğŸ¥¶">ğŸ¥¶</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜±">ğŸ˜±</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜¨">ğŸ˜¨</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜°">ğŸ˜°</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜¥">ğŸ˜¥</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜“">ğŸ˜“</div>
                    <div class="custom-emotion" data-emoji="ğŸ¤—">ğŸ¤—</div>
                    <div class="custom-emotion" data-emoji="ğŸ¤”">ğŸ¤”</div>
                    <div class="custom-emotion" data-emoji="ğŸ¤­">ğŸ¤­</div>
                    <div class="custom-emotion" data-emoji="ğŸ¤«">ğŸ¤«</div>
                    <div class="custom-emotion" data-emoji="ğŸ¤¥">ğŸ¤¥</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜¶">ğŸ˜¶</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜">ğŸ˜</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜‘">ğŸ˜‘</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜¬">ğŸ˜¬</div>
                    <div class="custom-emotion" data-emoji="ğŸ™„">ğŸ™„</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜¯">ğŸ˜¯</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜¦">ğŸ˜¦</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜§">ğŸ˜§</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜®">ğŸ˜®</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜²">ğŸ˜²</div>
                    <div class="custom-emotion" data-emoji="ğŸ¥±">ğŸ¥±</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜´">ğŸ˜´</div>
                    <div class="custom-emotion" data-emoji="ğŸ¤¤">ğŸ¤¤</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜ª">ğŸ˜ª</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜µ">ğŸ˜µ</div>
                    <div class="custom-emotion" data-emoji="ğŸ¤">ğŸ¤</div>
                    <div class="custom-emotion" data-emoji="ğŸ¥´">ğŸ¥´</div>
                    <div class="custom-emotion" data-emoji="ğŸ¤¢">ğŸ¤¢</div>
                    <div class="custom-emotion" data-emoji="ğŸ¤®">ğŸ¤®</div>
                    <div class="custom-emotion" data-emoji="ğŸ¤§">ğŸ¤§</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜·">ğŸ˜·</div>
                    <div class="custom-emotion" data-emoji="ğŸ¤’">ğŸ¤’</div>
                    <div class="custom-emotion" data-emoji="ğŸ¤•">ğŸ¤•</div>
                    <div class="custom-emotion" data-emoji="ğŸ¤‘">ğŸ¤‘</div>
                    <div class="custom-emotion" data-emoji="ğŸ¤ ">ğŸ¤ </div>
                    <div class="custom-emotion" data-emoji="ğŸ˜ˆ">ğŸ˜ˆ</div>
                    <div class="custom-emotion" data-emoji="ğŸ‘¿">ğŸ‘¿</div>
                    <div class="custom-emotion" data-emoji="ğŸ‘¹">ğŸ‘¹</div>
                    <div class="custom-emotion" data-emoji="ğŸ‘º">ğŸ‘º</div>
                    <div class="custom-emotion" data-emoji="ğŸ¤¡">ğŸ¤¡</div>
                    <div class="custom-emotion" data-emoji="ğŸ’©">ğŸ’©</div>
                    <div class="custom-emotion" data-emoji="ğŸ‘»">ğŸ‘»</div>
                    <div class="custom-emotion" data-emoji="ğŸ’€">ğŸ’€</div>
                    <div class="custom-emotion" data-emoji="â˜ ï¸">â˜ ï¸</div>
                    <div class="custom-emotion" data-emoji="ğŸ‘½">ğŸ‘½</div>
                    <div class="custom-emotion" data-emoji="ğŸ‘¾">ğŸ‘¾</div>
                    <div class="custom-emotion" data-emoji="ğŸ¤–">ğŸ¤–</div>
                    <div class="custom-emotion" data-emoji="ğŸƒ">ğŸƒ</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜º">ğŸ˜º</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜¸">ğŸ˜¸</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜¹">ğŸ˜¹</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜»">ğŸ˜»</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜¼">ğŸ˜¼</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜½">ğŸ˜½</div>
                    <div class="custom-emotion" data-emoji="ğŸ™€">ğŸ™€</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜¿">ğŸ˜¿</div>
                    <div class="custom-emotion" data-emoji="ğŸ˜¾">ğŸ˜¾</div>
                </div>
            </div>
            
            <div id="emotionTypeError" class="error-message" style="display: none;"></div>
        </div>
        
        <!-- æƒ…ç»ªå¼ºåº¦ -->
        <div class="form-group">
            <label class="form-label">æƒ…ç»ªå¼ºåº¦ *</label>
            <input type="range" id="intensitySlider" class="intensity-slider" min="1" max="10" value="5">
            <div class="intensity-labels">
                <span>è½»å¾® (1)</span>
                <span id="intensityValue">ä¸­ç­‰ (5)</span>
                <span>å¼ºçƒˆ (10)</span>
            </div>
        </div>
        
        <!-- æƒ…ç»ªæè¿° -->
        <div class="form-group">
            <label for="description" class="form-label">æè¿°ä½ çš„æ„Ÿå—</label>
            <textarea id="description" class="form-input" rows="4" placeholder="è¯¦ç»†æè¿°ä½ å½“å‰çš„æƒ…ç»ªå’Œæ„Ÿå—..."></textarea>
        </div>
        
        <!-- éšç§è®¾ç½® -->
        <div class="form-group">
            <label class="form-label">éšç§è®¾ç½® *</label>
            <div class="privacy-options">
                <div class="privacy-option">
                    <input type="radio" id="privacyPublic" name="privacy" value="public" checked>
                    <label for="privacyPublic" class="privacy-label">
                        <div class="privacy-icon">ğŸŒ</div>
                        <div class="privacy-text">
                            <div class="privacy-title">å…¬å¼€</div>
                            <div class="privacy-desc">æ‰€æœ‰äººéƒ½å¯ä»¥çœ‹åˆ°</div>
                        </div>
                    </label>
                </div>
                <div class="privacy-option">
                    <input type="radio" id="privacyPrivate" name="privacy" value="private">
                    <label for="privacyPrivate" class="privacy-label">
                        <div class="privacy-icon">ğŸ”’</div>
                        <div class="privacy-text">
                            <div class="privacy-title">ç§å¯†</div>
                            <div class="privacy-desc">åªæœ‰è‡ªå·±å¯ä»¥çœ‹åˆ°</div>
                        </div>
                    </label>
                </div>
            </div>
        </div>
        
        <!-- ä½ç½®é€‰æ‹© -->
        <div class="form-group">
            <label class="form-label">é€‰æ‹©ä½ç½® *</label>
            <div id="map" class="map-container"></div>
            <div id="locationInfo" class="location-info">
                ç‚¹å‡»åœ°å›¾é€‰æ‹©ä½ç½®ï¼Œæˆ–ä½¿ç”¨ä¸‹æ–¹æŒ‰é’®è·å–å½“å‰ä½ç½®
            </div>
            <button type="button" id="getCurrentLocation" class="btn btn-secondary" style="margin-top: 2.5rem;">è·å–å½“å‰ä½ç½®</button>
            <div id="locationError" class="error-message" style="display: none;"></div>
        </div>
        
        <!-- æäº¤æŒ‰é’® -->
        <div class="btn-group">
            <button type="submit" class="btn btn-primary">å‘å¸ƒæƒ…ç»ª</button>
            <a href="{{ url_for('index') }}" class="btn btn-secondary">å–æ¶ˆ</a>
        </div>
        
        <div id="submitMessage" style="margin-top: 1rem;"></div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="{{ url_for('static', filename='js/add-emotion.js') }}"></script>
{% endblock %}